<% content_for :title do %>
<%= @slide.title %>, <%= @slide.description.truncate(20) %>
<% end %>

<div class="row slide-page">
  <div class="col-md-8">
    <% if @slide.done? && @slide.previews.any? %>
      <div class="pages-container">
        <%= render 'pages', slide: @slide %>
      </div>

      <div class="operations">
        <%= link_to '#fullscreen', class: 'fullscreen btn btn-sm btn-danger pull-right' do %>
          <i class="glyphicon glyphicon-fullscreen"></i>
        <% end %>

        <%# https://trello.com/c/Xi7rWbt1/30-1  %>
        <% link_to collect_slide_path(@slide), id: 'collect_slide_btn', class: 'btn btn-sm btn-primary pull-right', disabled: current_user && current_user.collected_slide?(@slide), style: 'margin-left: 5px;', method: :post, remote: true do %>
          <span class="glyphicon glyphicon-pushpin"></span>
          收藏 (<span id='collections_count'><%= @slide.collections_count %></span>)
        <% end %>
        <%= link_to like_slide_path(@slide), id: 'like_slide_btn', class: 'btn btn-sm btn-primary pull-right', disabled: current_user && current_user.liked_slide?(@slide), method: :post, remote: true do %>
          <span class="glyphicon glyphicon-thumbs-up"></span>
          赞 (<span id='likes_count'><%= @slide.likes_count %></span>)
        <% end %>

        <div class="clearfix"></div>
      </div>
    <% else %>
      <% if current_user && current_user == @slide.user %>
        <%= render 'manual_actions', slide: @slide %>
      <% else %>
        <h4>对不起，您查看的讲稿正在处理中，请稍待几分钟后刷新重试。</h4>
      <% end %>
    <% end %>

    <div class="slide-infos">
      <h4><%= @slide.title %></h4>
      <p><%= @slide.description %></p>
    </div>
  </div>

  <div class="col-md-4 slide-page-sidebar">
    <div class="author-infos">

      <div class="clearfix"></div>

      <div class="share-panel">
        <ul class="list-group">
          <li class="list-group-item">
            <h4 class="list-group-item-heading">讲稿详情</h4>
            <div class="list-group-item-text">
              <p>
                标题：
                《<%= @slide.title %>》
              </p>
              <p>
                作者：
                <%= @slide.author %>
              </p>
              <p>
                总页数：
                <%= @slide.previews.any? ? @slide.previews.count : "处理中" %>
              </p>
              <p>
                总浏览量：
                <%= @slide.visits_count %>
              </p>
              <p>
                成功发表于：<%= l @slide.created_at, format: :long %>
              </p>
              <p>
                是否支持原版PDF下载：<%= @slide.downloadable ? "是" : "否" %>
              </p>
            </div>
          </li>

          <% if @slide.user == current_user %>
            <li class="list-group-item">
              <div>
                <%= link_to "编辑", edit_slide_path(@slide) %>
              </div>
              <div>
                <%= link_to "删除", slide_path(@slide, from: :show), method: :delete, data: { toggle: 'tooltip', confirm: "确认删除？" } %>
              </div>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
  </div>
</div>
